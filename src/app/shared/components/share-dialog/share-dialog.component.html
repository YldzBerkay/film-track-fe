@if (isOpen()) {
<div class="dialog-overlay" (click)="closeDialog($event)">
    <div class="dialog-content" (click)="$event.stopPropagation()">
        <button class="close-btn" (click)="closeDialog()">
            <span class="material-symbols-outlined">close</span>
        </button>

        <h2>{{ 'share.title' | translate }}</h2>

        <div class="capture-container" #captureArea>
            <div class="card-header">
                <div class="user-info">
                    <img [src]="profile()?.user?.avatar || 'assets/default-avatar.png'" class="avatar"
                        crossorigin="anonymous">
                    <div class="names">
                        <span class="name">{{ profile()?.user?.name }}</span>
                        <span class="username">@{{ profile()?.user?.username }}</span>
                    </div>
                </div>
                <div class="app-logo">
                    <span class="logo-text">CineTrack</span>
                </div>
            </div>

            <div class="card-body">
                <div class="chart-section">
                    <app-mood-chart [moodData]="moodData()" [isLoading]="false"></app-mood-chart>
                </div>

                <div class="identity-section">
                    <span class="identity-label">{{ 'share.moodIdentity' | translate }}</span>
                    <h3 class="identity-value">{{ ('mood.' + primaryMood) | translate }}</h3>
                </div>

                <div class="badges-row">
                    @for (badge of topBadges; track badge.id) {
                    <div class="badge-mini">
                        <span class="material-symbols-outlined">{{ badge.icon }}</span>
                        <span class="badge-name">{{ ('badges.' + badge.id + '.name') | translate }}</span>
                    </div>
                    }
                </div>
            </div>

            <div class="card-footer">
                <span class="footer-link">cinetrack.com/u/{{ profile()?.user?.username }}</span>
                <span class="footer-date">{{ 'share.generatedOn' | translate:{ date: (currentDate |
                    date:'mediumDate':undefined:currentLang())
                    || '' }
                    }}</span>
            </div>
        </div>

        <div class="actions">
            <button class="action-btn secondary" (click)="shareProfile()">
                <span class="material-symbols-outlined">ios_share</span>
                {{ 'share.shareLink' | translate }}
            </button>
            <button class="action-btn primary" (click)="downloadImage()" [disabled]="isGenerating()">
                <span class="material-symbols-outlined">download</span>
                {{ (isGenerating() ? 'share.generating' : 'share.downloadImage') | translate }}
            </button>
        </div>
    </div>
</div>
}