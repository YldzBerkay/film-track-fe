@switch (activity.type) {
@case ('review') {
<!-- Full Review Card - Review card has its own click handling -->
<div (click)="onCardClick()" [class.clickable]="viewMode === 'feed'">
    <app-review-card [activity]="activity" [isFeedView]="viewMode === 'feed'" [viewMode]="viewMode"
        [highlightCommentId]="highlightCommentId" (click)="onInteractiveClick($event)"></app-review-card>
</div>
}

@case ('rating') {
<!-- Mini Rating Card -->
<div class="activity-card mini-card rating-card" [class.clickable]="viewMode === 'feed'" (click)="onCardClick()">
    <div class="mini-icon rating-icon">
        <span class="material-symbols-outlined">star</span>
    </div>
    <div class="mini-content">
        <div class="mini-header">
            <span class="mini-user">
                <a [routerLink]="profileLink" (click)="onInteractiveClick($event)">{{ activity.userId.name ||
                    activity.userId.username }}</a>
            </span>
            <span class="mini-action">{{ 'activity.rated' | translate }}</span>
            <a [routerLink]="mediaLink" class="mini-media" (click)="onInteractiveClick($event)">{{ activity.mediaTitle
                }}</a>
        </div>
        <div class="mini-meta">
            <span class="rating-badge">
                <span class="material-symbols-outlined">star</span>
                {{ activity.rating }}
            </span>
            @if ($any(activity).isMoodPick) {
            <span class="mood-pick-badge" title="You liked this from your Mood Recommendations">
                <span class="material-symbols-outlined">auto_awesome</span>
                <span class="mood-text">{{ 'activity.moodPick' | translate }}</span>
            </span>
            }
            <span class="dot">â€¢</span>
            <span class="time">{{ activity.createdAt | date:'mediumDate' }}</span>
        </div>
    </div>
    <a [routerLink]="mediaLink" class="mini-poster" (click)="onInteractiveClick($event)">
        <img [src]="posterUrl" [alt]="activity.mediaTitle">
    </a>
</div>
}

@case ('comment') {
<!-- Comment Activity Card -->
<div class="activity-card mini-card comment-card" [class.clickable]="viewMode === 'feed'" (click)="onCardClick()">
    <div class="mini-icon comment-icon">
        <span class="material-symbols-outlined">{{ activity.parentId ? 'reply' : 'chat_bubble' }}</span>
    </div>
    <div class="mini-content">
        <div class="mini-header">
            <span class="mini-user">
                <a [routerLink]="profileLink" (click)="onInteractiveClick($event)">{{ activity.userId.name ||
                    activity.userId.username }}</a>
            </span>
            @if (activity.parentId) {
            <!-- It's a reply -->
            @if (activity.replyToUser) {
            <span class="mini-action">{{ 'activity.repliedTo' | translate }}</span>
            <a [routerLink]="['/profile', activity.replyToUser.username]" class="reply-target"
                (click)="onInteractiveClick($event)">@{{
                activity.replyToUser.username }}</a>
            <span class="mini-action">{{ 'activity.on' | translate }}</span>
            } @else {
            <span class="mini-action">{{ 'activity.repliedToComment' | translate }}</span>
            }
            } @else {
            <!-- Root comment -->
            <span class="mini-action">{{ 'activity.commentedOn' | translate }}</span>
            <span class="target-type">{{ (activity.originalActivityType === 'review' ? 'activity.reviewOf' :
                'activity.postOf') | translate }}</span>
            }
            <a [routerLink]="mediaLink" class="mini-media" (click)="onInteractiveClick($event)">{{ activity.mediaTitle
                }}</a>
        </div>

        @if (activity.parentId && activity.parentCommentText) {
        <!-- Show parent comment snippet for context -->
        <div class="parent-comment-snippet">
            <span class="material-symbols-outlined">format_quote</span>
            <span class="snippet-text">{{ activity.parentCommentText | slice:0:80 }}{{ activity.parentCommentText.length
                > 80 ? '...' : '' }}</span>
        </div>
        }

        <div class="comment-bubble">
            <span class="quote-mark">"</span>
            {{ activity.commentText }}
            <span class="quote-mark">"</span>
        </div>

        <div class="mini-meta">
            <span class="time">{{ activity.createdAt | date:'short' }}</span>
        </div>
    </div>
    <a [routerLink]="mediaLink" class="mini-poster" (click)="onInteractiveClick($event)">
        <img [src]="posterUrl" [alt]="activity.mediaTitle">
    </a>
</div>
}

@case ('bulk_import') {
<!-- Bulk Import Summary -->
<div class="activity-card mini-card import-card" [class.clickable]="viewMode === 'feed'" (click)="onCardClick()">
    <div class="mini-icon import-icon">
        <span class="material-symbols-outlined">folder_open</span>
    </div>
    <div class="mini-content">
        <div class="mini-header">
            <span class="mini-user">
                <a [routerLink]="profileLink" (click)="onInteractiveClick($event)">{{ activity.userId.name ||
                    activity.userId.username }}</a>
            </span>
            <span class="mini-action">{{ 'activity.importedHistory' | translate }}</span>
        </div>
        <div class="import-stats">
            <span class="stat-badge">
                <span class="material-symbols-outlined">movie</span>
                {{ 'activity.itemsImported' | translate }}
            </span>
        </div>
        <div class="mini-meta">
            <span class="time">{{ activity.createdAt | date:'mediumDate' }}</span>
        </div>
    </div>
</div>
}

@case ('movie_watched') {
<!-- Simple Watched Log -->
<div class="activity-card mini-card watched-card" [class.clickable]="viewMode === 'feed'" (click)="onCardClick()">
    <div class="mini-icon watched-icon">
        <span class="material-symbols-outlined">visibility</span>
    </div>
    <div class="mini-content">
        <div class="mini-header">
            <span class="mini-user">
                <a [routerLink]="profileLink" (click)="onInteractiveClick($event)">{{ activity.userId.name ||
                    activity.userId.username }}</a>
            </span>
            <span class="mini-action">{{ 'activity.watched' | translate }}</span>
            <a [routerLink]="mediaLink" class="mini-media" (click)="onInteractiveClick($event)">{{ activity.mediaTitle
                }}</a>
        </div>
        <div class="mini-meta">
            <span class="time">{{ activity.createdAt | date:'mediumDate' }}</span>
            @if (activity.isMoodPick) {
            <span class="mood-pick-badge" title="You liked this from your Mood Recommendations">
                <span class="material-symbols-outlined">auto_awesome</span>
                <span class="mood-text">{{ 'activity.moodPick' | translate }}</span>
            </span>
            }
        </div>
    </div>
    <a [routerLink]="mediaLink" class="mini-poster" (click)="onInteractiveClick($event)">
        <img [src]="posterUrl" [alt]="activity.mediaTitle">
    </a>
</div>
}
@default {
<!-- Fallback for other types -->
<div class="activity-card mini-card" [class.clickable]="viewMode === 'feed'" (click)="onCardClick()">
    <div class="mini-content">{{ activity.type }}</div>
</div>
}
}