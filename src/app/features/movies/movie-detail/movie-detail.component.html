@if (isLoading()) {
<div class="loading-container">
  <div class="loading">Loading movie details...</div>
</div>
} @else if (error()) {
<div class="error-container">
  <div class="error-message">{{ error() }}</div>
  <button class="back-btn" (click)="router.navigate(['/'])" type="button">Go Back</button>
</div>
} @else if (movie()) {
@let movieData = movie()!;
<div class="movie-detail-container">
  <!-- Hero Section with Backdrop -->
  <div class="hero-section"
    [style.background-image]="'url(' + tmdbService.getBackdropUrl(movieData.backdrop_path) + ')'">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <button class="back-button" (click)="goBack()" type="button">
        <span class="material-symbols-outlined">arrow_back</span>
        Back
      </button>
      <div class="hero-info">
        <div class="hero-poster">
          <img [src]="tmdbService.getPosterUrl(movieData.poster_path, 'w500')" [alt]="movieData.title"
            class="poster-image" />
        </div>
        <div class="hero-details">
          <h1 class="movie-title">
            {{ movieData.title }}
            <span class="movie-year">({{ formatDate(movieData.release_date) }})</span>
          </h1>
          <div class="movie-meta">
            @if (movieData.release_date) {
            <span class="meta-item">{{ formatDate(movieData.release_date) }}</span>
            }
            @if (movieData.runtime) {
            <span class="meta-separator">•</span>
            <span class="meta-item">{{ formatRuntime(movieData.runtime) }}</span>
            }
            @if (movieData.genres && movieData.genres.length > 0) {
            <span class="meta-separator">•</span>
            <span class="meta-item">{{ movieData.genres[0].name }}</span>
            }
          </div>
          @if (movieData.vote_average) {
          <div class="rating-section">
            <div class="rating-stars">
              @for (star of getStars(movieData.vote_average); track $index) {
              @if (star === 1) {
              <span class="material-symbols-outlined star-filled">star</span>
              } @else if (star === 0.5) {
              <span class="material-symbols-outlined star-half">star_half</span>
              } @else {
              <span class="material-symbols-outlined star-empty">star</span>
              }
              }
            </div>
            <span class="rating-value">{{ movieData.vote_average.toFixed(1) }}/10</span>
            <span class="rating-count">({{ movieData.vote_count }} votes)</span>
          </div>
          }
          <div class="action-buttons">
            <button class="btn-primary" (click)="onLogClick()">
              <span class="material-symbols-outlined">add</span>
              Log
            </button>
            <button class="btn-secondary" (click)="onAddToList()">
              <span class="material-symbols-outlined">bookmark_add</span>
              Add to List
            </button>
            <button class="btn-icon">
              <span class="material-symbols-outlined">favorite</span>
            </button>
            <button class="btn-icon">
              <span class="material-symbols-outlined">share</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="content-grid">
      <!-- Left Column -->
      <div class="content-main">
        <!-- Overview -->
        @if (movieData.overview) {
        <section class="section">
          <h2 class="section-title">Overview</h2>
          <p class="overview-text">{{ movieData.overview }}</p>
        </section>
        }

        <!-- Cast -->
        @if (movieData.credits && movieData.credits.cast && movieData.credits.cast.length > 0) {
        <section class="section">
          <h2 class="section-title">Cast</h2>
          <div class="cast-grid">
            @for (actor of movieData.credits.cast.slice(0, 12); track actor.id) {
            <div class="cast-item">
              <div class="cast-image">
                @if (actor.profile_path) {
                <img [src]="tmdbService.getPosterUrl(actor.profile_path, 'w185')" [alt]="actor.name" />
                } @else {
                <div class="cast-placeholder">
                  <span class="material-symbols-outlined">person</span>
                </div>
                }
              </div>
              <div class="cast-info">
                <p class="cast-name">{{ actor.name }}</p>
                <p class="cast-character">{{ actor.character }}</p>
              </div>
            </div>
            }
          </div>
        </section>
        }

        <!-- Similar Movies -->
        @if (movieData.similar && movieData.similar.results && movieData.similar.results.length > 0) {
        <section class="section">
          <h2 class="section-title">Similar Movies</h2>
          <div class="similar-grid">
            @for (similar of movieData.similar.results.slice(0, 6); track similar.id) {
            <div class="similar-item" (click)="router.navigate(['/movies', similar.id])">
              <div class="similar-poster">
                <img [src]="tmdbService.getPosterUrl(similar.poster_path, 'w300')" [alt]="similar.title" />
              </div>
              <div class="similar-info">
                <h3 class="similar-title">{{ similar.title }}</h3>
                @if (similar.release_date) {
                <p class="similar-year">{{ formatDate(similar.release_date) }}</p>
                }
              </div>
            </div>
            }
          </div>
        </section>
        }
      </div>

      <!-- Right Sidebar -->
      <aside class="sidebar">
        <!-- Info Box -->
        <div class="info-box">
          <h3 class="info-title">Movie Info</h3>
          <div class="info-list">
            @if (movieData.release_date) {
            <div class="info-item">
              <span class="info-label">Release Date</span>
              <span class="info-value">{{ movieData.release_date | date: 'longDate' }}</span>
            </div>
            }
            @if (movieData.runtime) {
            <div class="info-item">
              <span class="info-label">Runtime</span>
              <span class="info-value">{{ formatRuntime(movieData.runtime) }}</span>
            </div>
            }
            @if (movieData.budget && movieData.budget > 0) {
            <div class="info-item">
              <span class="info-label">Budget</span>
              <span class="info-value">${{ movieData.budget | number }}</span>
            </div>
            }
            @if (movieData.revenue && movieData.revenue > 0) {
            <div class="info-item">
              <span class="info-label">Revenue</span>
              <span class="info-value">${{ movieData.revenue | number }}</span>
            </div>
            }
            @if (movieData.status) {
            <div class="info-item">
              <span class="info-label">Status</span>
              <span class="info-value">{{ movieData.status }}</span>
            </div>
            }
          </div>
        </div>

        <!-- Genres -->
        @if (movieData.genres && movieData.genres.length > 0) {
        <div class="info-box">
          <h3 class="info-title">Genres</h3>
          <div class="genres-list">
            @for (genre of movieData.genres; track genre.id) {
            <span class="genre-tag">{{ genre.name }}</span>
            }
          </div>
        </div>
        }

        <!-- Production Companies -->
        @if (movieData.production_companies && movieData.production_companies.length > 0) {
        <div class="info-box">
          <h3 class="info-title">Production</h3>
          <div class="production-list">
            @for (company of movieData.production_companies; track company.id) {
            <div class="production-item">
              @if (company.logo_path) {
              <img [src]="tmdbService.getPosterUrl(company.logo_path, 'w92')" [alt]="company.name"
                class="production-logo" />
              } @else {
              <span class="production-name">{{ company.name }}</span>
              }
            </div>
            }
          </div>
        </div>
        }

        <!-- Crew -->
        @if (movieData.credits && movieData.credits.crew && movieData.credits.crew.length > 0) {
        <div class="info-box">
          <h3 class="info-title">Crew</h3>
          <div class="crew-list">
            @for (member of movieData.credits.crew.slice(0, 5); track member.id) {
            <div class="crew-item">
              <span class="crew-name">{{ member.name }}</span>
              <span class="crew-job">{{ member.job }}</span>
            </div>
            }
          </div>
        </div>
        }
      </aside>
    </div>
  </div>
</div>
}